{% extends 'base.html' %}
{% block title %}Shop - Pethood{% endblock %}
{% load static %}
{% block content %}

<div class="product-detail">
  <div class="image-section">
    <img src="{{ product.image.url }}" alt="{{ product.name }}">
  </div>

  <div class="info-section">
    <h2>{{ product.name }}</h2>
    <p class="price">${{ product.price }}</p>
    <p class="description">{{ product.description }}</p>

    {% if product.category == "clothes" or product.category == "accessories" %}
       <label for="size-select-{{ product.id }}">Select Size:</label>
       <select id="size-select-{{ product.id }}">
        
        <option value="S">Small</option>
        <option value="M" {% if product.size == "M" %}selected{% endif %}>Medium</option>
        <option value="L">Large</option>
      </select>
    {% endif %}

    <button class="add-cart" data-product-id="{{ product.id }}">Add to Cart</button>
  </div>
</div>

<!-- ORIGINAL CSS from yesterday -->
<style>
.product-detail {
  display: flex;
  flex-wrap: wrap;
  max-width: 1000px;
  margin: 40px auto;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  overflow: hidden;
  transition: transform 0.3s ease;
}
.product-detail:hover { transform: translateY(-5px); }

.image-section {
  flex: 1 1 400px;
  background: #f9f9f9;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.image-section img {
  max-width: 100%;
  max-height: 450px;
  object-fit: contain;
  border-radius: 12px;
}

.info-section {
  flex: 1 1 400px;
  padding: 30px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.info-section h2 { font-size: 28px; font-weight: 700; margin-bottom: 15px; }
.info-section .price { font-size: 22px; color: #bd6c49; font-weight: bold; margin-bottom: 20px; }
.info-section .description { font-size: 16px; color: #555; margin-bottom: 25px; line-height: 1.6; }
.info-section label { font-weight: 600; margin-bottom: 8px; display: block; }
.info-section select {
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
  margin-bottom: 25px;
  cursor: pointer;
  transition: border 0.2s, box-shadow 0.2s;
}
.info-section select:hover, .info-section select:focus {
  border-color: #283f57;
  box-shadow: 0 0 6px rgba(224,123,82,0.3);
}

.add-cart {
  background: #0f1010;
  color: #fff;
  padding: 14px 25px;
  font-size: 16px;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
}
.add-cart:hover {
  background: #293b48;
  transform: translateY(-2px);
}

@media (max-width: 900px) {
  .product-detail { flex-direction: column; }
  .image-section, .info-section { flex: 1 1 100%; }
  .info-section { padding: 20px; }
}
</style>

<!-- AJAX Add to Cart JS -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Select all Add to Cart buttons
    const buttons = document.querySelectorAll('.add-cart');

    buttons.forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.productId;

            // Get the size if the selector exists
            const sizeSelector = document.querySelector(`#size-select-${productId}`);
            const size = sizeSelector ? sizeSelector.value : null;

            fetch(`/add-to-cart-ajax/${productId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ size: size })
            })
            .then(res => res.json())
            .then(data => {
                if(data.success){
                    // Update floating cart count
                    const cartCount = document.getElementById('cart-count');
                    if(cartCount) cartCount.innerText = data.cart_count;

                    // Show temporary success message on button
                    const originalText = this.innerText;
                    this.innerText = "Added Successfully";
                    this.disabled = true;

                    setTimeout(() => {
                        this.innerText = originalText;
                        this.disabled = false;
                    }, 1000);
                }
            })
            .catch(err => console.error('Error adding to cart:', err));
        });
    });
});
</script>



{% endblock %}




