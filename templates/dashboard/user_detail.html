{% extends 'dashboard/base.html' %}

{% block title %}{{ viewed_user.username }} - Pethood Admin{% endblock %}
{% block page_title %}User Details: {{ viewed_user.username }}{% endblock %}

{% block content %}
<style>
.user-header {
    background: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.user-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.stat-box {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
}

.stat-box h3 {
    font-size: 32px;
    color: #667eea;
    margin-bottom: 5px;
}

.stat-box p {
    color: #666;
    font-size: 14px;
}

.section {
    background: white;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.section h3 {
    margin-bottom: 20px;
    color: #333;
}
</style>

<div class="user-header">
    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
        <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; font-weight: bold;">
            {{ viewed_user.username|first|upper }}
        </div>
        <div>
            <h2 style="margin-bottom: 5px;">{{ viewed_user.first_name }} {{ viewed_user.last_name }}</h2>
            <p style="color: #666;">@{{ viewed_user.username }} | {{ viewed_user.email }}</p>
            <p style="color: #999; font-size: 14px;">Member since {{ viewed_user.date_joined|date:"F Y" }}</p>
        </div>
    </div>

    <div class="user-stats">
        <div class="stat-box">
            <h3>{{ orders.count }}</h3>
            <p>Total Orders</p>
        </div>
        <div class="stat-box">
            <h3>NPR {{ total_spent }}</h3>
            <p>Total Spent</p>
        </div>
        <div class="stat-box">
            <h3>{{ dogs.count }}</h3>
            <p>Dog Listings</p>
        </div>
    </div>
</div>

<!-- Order History -->
<div class="section">
    <h3><i class="fas fa-shopping-cart"></i> Order History</h3>
    {% if orders %}
    <table>
        <thead>
            <tr>
                <th>Order #</th>
                <th>Date</th>
                <th>Items</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td><strong>#{{ order.order_number }}</strong></td>
                <td>{{ order.created_at|date:"M d, Y" }}</td>
                <td>{{ order.items.count }}</td>
                <td><strong>NPR {{ order.total_amount }}</strong></td>
                <td><span class="badge badge-{{ order.status }}">{{ order.get_status_display }}</span></td>
                <td>
                    <a href="{% url 'dashboard:order_detail' order.id %}" class="btn btn-primary btn-sm">
                        <i class="fas fa-eye"></i> View
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 40px; color: #999;">No orders yet</p>
    {% endif %}
</div>

<!-- Dog Listings -->
<div class="section">
    <h3><i class="fas fa-dog"></i> Dog Listings</h3>
    {% if dogs %}
    <table>
        <thead>
            <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Breed</th>
                <th>Age</th>
                <th>Posted</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for dog in dogs %}
            <tr>
                <td>
                    <img src="{{ dog.image.url }}" alt="{{ dog.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">
                </td>
                <td><strong>{{ dog.name }}</strong></td>
                <td>{{ dog.breed }}</td>
                <td>{{ dog.age }} months</td>
                <td>{{ dog.created_at|date:"M d, Y" }}</td>
                <td>
                    {% if dog.is_adopted %}
                        <span class="badge badge-cancelled">Adopted</span>
                    {% elif dog.is_approved %}
                        <span class="badge badge-approved">Approved</span>
                    {% else %}
                        <span class="badge badge-unapproved">Pending</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 40px; color: #999;">No dog listings</p>
    {% endif %}
</div>

<a href="{% url 'dashboard:user_list' %}" class="btn btn-secondary">
    <i class="fas fa-arrow-left"></i> Back to Users
</a>
{% endblock %}
